<% layout('layouts/bolierplate') %>

<div class="container mt-5 d-flex justify-content-center">

  <div class="compose-container w-100" style="max-width: 700px;">

    <!-- TITLE -->
    <h2 class="fw-bold text-center mb-4">Phishing Email Checker</h2>

    <!-- FORM CARD -->
    <form id="checkForm" class="p-3">

      <!-- SUBJECT -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Subject</label>
        <input 
          type="text" 
          id="subject" 
          class="form-control rounded-3" 
          placeholder="Enter subject"
        >
      </div>

      <!-- BODY -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Email Body</label>
        <textarea 
          id="body" 
          class="form-control rounded-3"
          style="height: 140px"
          placeholder="Paste email body here"
        ></textarea>
      </div>

      <!-- BUTTONS INLINE -->
      <div class="d-flex gap-3 mt-3">
        <button type="submit" class="btn btn-primary px-4 py-2 rounded-3">
          Check
        </button>

        <button 
          type="button" 
          id="clearBtn" 
          class="btn btn-secondary px-4 py-2 rounded-3"
        >
          Clear
        </button>
      </div>

    </form>

    <!-- OUTPUT -->
    <div 
      id="output" 
      class="mt-4 fw-semibold text-secondary rounded-3 p-3"
      style="background:#f8f9fa; border: 1px solid #e0e0e0; font-size: 1rem;"
    ></div>

  </div>

</div>

<script>
  document.getElementById("checkForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const subject = document.getElementById("subject").value;
    const body = document.getElementById("body").value;
    const out = document.getElementById("output");

    out.innerHTML = "Checking...";
    out.style.color = "#555";

    const res = await fetch("/phishing/check", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ subject, body })
    });

    const data = await res.json();

    out.innerHTML = `
      <span class="fw-bold">${data.status}</span> â€” 
      <span class="text-primary">Risk: <b>${data.risk}</b></span><br>
      <small>${data.explanation}</small>
    `;
  });

  document.getElementById("clearBtn").addEventListener("click", () => {
    document.getElementById("subject").value = "";
    document.getElementById("body").value = "";
    document.getElementById("output").innerHTML = "";
  });
</script>
