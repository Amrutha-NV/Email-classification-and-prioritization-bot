<% layout("layouts/bolierplate.ejs") %>

<body>

<div class="container mt-4">

    <div class="email-container">

        <div class="card shadow-sm border-0 rounded-4 p-3">

            <div class="card-body">

                <!-- TOP ROW -->
                <div class="d-flex justify-content-between align-items-center mb-3">

                    <!-- LEFT: Avatar + Sender + Subject -->
                    <div class="d-flex align-items-center gap-3">

                        <!-- Avatar -->
                        <div class="rounded-circle text-white d-flex justify-content-center align-items-center flex-shrink-0"
                             style="width: 48px; height: 48px; font-size: 1.2rem;"
                             data-email="<%= email.from %>">
                            <%= email.from.charAt(0).toUpperCase() %>
                        </div>

                        <!-- Sender + Subject -->
                        <div class="d-flex flex-column">

                            <!-- Subject -->
                            <h3 class="fw-bold m-0"><%= email.subject %></h3>

                            <!-- From -->
                            <span class="text-muted">
                                <strong>From:</strong> <%= email.from %>
                            </span>

                        </div>

                    </div>

                    <!-- RIGHT: LABEL BADGE -->
                    <div>

                        <% if (email.label === 'promotions') { %>
                            <span class="badge rounded-pill text-bg-danger px-3 py-2">
                                <%= email.label %>
                            </span>

                        <% } else if (email.label === 'work') { %>
                            <span class="badge rounded-pill text-bg-success px-3 py-2">
                                <%= email.label %>
                            </span>

                        <% } else if (email.label === 'personal') { %>
                            <span class="badge rounded-pill text-bg-primary px-3 py-2">
                                <%= email.label %>
                            </span>

                        <% } else if (email.label === 'spam') { %>
                            <span class="badge rounded-pill text-bg-warning px-3 py-2">
                                <%= email.label %>
                            </span>

                        <% } else { %>
                            <span class="badge rounded-pill text-bg-dark px-3 py-2">
                                <%= email.label %>
                            </span>
                        <% } %>

                    </div>
                </div>

                <!-- EMAIL BODY -->
                <div class="mt-3">
                    <p class="text-secondary" style="white-space: pre-line;">
                        <%= email.body %>
                    </p>

                    <% if (email.link) { %>
                    <p>
                        <a href="<%= email.link %>" target="_blank" class="btn btn-outline-primary btn-sm">
                            Open Link
                        </a>
                    </p>
                    <% } %>
                </div>

                <!-- ACTION BUTTONS -->
                <div class="mt-4 d-flex gap-3">

                    <a href="/emails/compose" class="btn btn-primary px-4">Reply</a>

                    <% if (email.urgent === true) { %>
                        <a href="/draft/from-email/<%= email._id %>" 
                           class="btn btn-warning text-dark px-4">
                           Draft Message
                        </a>
                    <% } %>

                    <a href="#" class="btn btn-secondary px-4">Forward</a>

                    <form method="post" action="/emails/<%= email._id %>?_method=DELETE">
                        <button class="btn btn-danger px-4">Delete</button>
                    </form>

                </div>

            </div>

        </div>

    </div>

</div>

<!-- AUTO-COLOR AVATAR -->
<script>
document.querySelectorAll('[data-email]').forEach(avatar => {
    const email = avatar.dataset.email || "user";
    let hash = 0;

    for (let i = 0; i < email.length; i++) {
        hash = email.charCodeAt(i) + ((hash << 5) - hash);
    }

    const hue = Math.abs(hash % 360);
    avatar.style.backgroundColor = `hsl(${hue}, 70%, 55%)`;
});
</script>

</body>
